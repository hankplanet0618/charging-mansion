<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>宜蘭礁溪充電莊 - 頂級露營體驗</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --forest-green: #15803d; --sunny-yellow: #eab308; }
        .glass-effect { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .zone-card { transition: all 0.3s ease; border: 1px solid #e5e7eb; }
        .zone-card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); border-color: var(--forest-green); }
        .selected { border: 2px solid var(--forest-green); background-color: #f0fdf4; transform: scale(1.02); }
        .cursor-change-image { cursor: pointer; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.6s ease-out forwards; }
        .filter-btn.active { background-color: var(--forest-green); color: white; }
    </style>
</head>
<body class="bg-stone-50 text-stone-800 font-sans">

    <div id="overlay" onclick="closeAll()" class="fixed inset-0 bg-black bg-opacity-60 z-40 hidden transition-opacity duration-300"></div>

    <nav class="fixed w-full z-30 transition-all duration-300 bg-stone-900/95 text-white backdrop-blur-md shadow-lg">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-4">
                <button onclick="toggleSidebar()" class="text-white hover:text-yellow-400 text-xl focus:outline-none"><i class="fas fa-bars"></i></button>
                <h1 class="text-xl font-bold tracking-wider flex items-center">
                    <i class="fas fa-bolt text-yellow-400 mr-2"></i> 充電莊
                </h1>
            </div>
            <button onclick="adminLogin()" class="text-xs border border-yellow-500 text-yellow-400 px-3 py-1 rounded hover:bg-yellow-500 hover:text-black transition focus:outline-none">
                營主後台
            </button>
        </div>
    </nav>

    <div id="sidebar" class="fixed inset-y-0 left-0 w-72 bg-white shadow-2xl transform -translate-x-full transition-transform duration-300 z-50 flex flex-col">
        <div class="h-48 bg-stone-800 flex flex-col justify-end p-6 text-white relative overflow-hidden">
            <i class="fas fa-mountain text-8xl absolute -right-4 -bottom-8 text-stone-700 opacity-50"></i>
            <h2 class="text-2xl font-bold relative z-10">選單導覽</h2>
            <p class="text-sm text-gray-400 relative z-10">探索充電莊的更多細節</p>
        </div>
        <div class="flex-1 overflow-y-auto py-2">
            <a href="#" onclick="showModal('modal-report')" class="flex items-center px-6 py-4 bg-yellow-50 text-stone-800 font-bold border-b border-yellow-200"><i class="fas fa-file-invoice-dollar w-8 text-yellow-600"></i> 匯款回報</a>
            <a href="#" onclick="showModal('modal-about')" class="flex items-center px-6 py-4 hover:bg-green-50 text-stone-600 border-b border-gray-100"><i class="fas fa-seedling w-8 text-green-600"></i> 關於充電莊</a>
            <a href="#" onclick="showModal('modal-rules')" class="flex items-center px-6 py-4 hover:bg-green-50 text-stone-600 border-b border-gray-100"><i class="fas fa-clipboard-check w-8 text-red-600"></i> 營區須知</a>
            <a href="#" onclick="showModal('modal-bank')" class="flex items-center px-6 py-4 hover:bg-green-50 text-stone-600 border-b border-gray-100"><i class="fas fa-university w-8 text-blue-600"></i> 匯款資訊</a>
            <a href="#" onclick="showModal('modal-bbq')" class="flex items-center px-6 py-4 hover:bg-green-50 text-stone-600 border-b border-gray-100"><i class="fas fa-fire w-8 text-orange-600"></i> 烤肉預定</a>
            <a href="#" onclick="showModal('modal-gear')" class="flex items-center px-6 py-4 hover:bg-green-50 text-stone-600 border-b border-gray-100"><i class="fas fa-toolbox w-8 text-blue-600"></i> 裝備出租</a>
            <a href="#" onclick="showModal('modal-tent')" class="flex items-center px-6 py-4 hover:bg-green-50 text-stone-600 border-b border-gray-100"><i class="fas fa-campground w-8 text-purple-600"></i> 免搭帳服務</a>
        </div>
    </div>

    <header class="bg-stone-900 pt-20 pb-8 px-0 flex justify-center items-center">
        <div class="relative w-full max-w-7xl mx-auto">
            <div class="relative aspect-video w-full overflow-hidden md:rounded-2xl shadow-2xl bg-black">
                <img src="https://i.ibb.co/6cx1xrVR/image.jpg" alt="山景" class="w-full h-full object-contain mx-auto opacity-90">
                <div class="absolute inset-0 flex flex-col items-center justify-center text-center p-4 bg-gradient-to-t from-black/60 via-transparent to-transparent">
                    <h2 class="text-3xl md:text-5xl font-bold mb-2 text-white text-shadow-lg tracking-tight">露營，是心靈充電的最佳選擇</h2>
                    <p class="text-yellow-400 font-bold tracking-widest text-sm md:text-lg">宜蘭礁溪秘境 ｜ 電動車露營首選｜ 訂位輸入電話號碼自動累積會員點數</p>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 pb-12 -mt-6 relative z-10" id="booking-section">
        
        <div class="grid grid-cols-3 gap-2 md:gap-4 mb-8 fade-in">
            <div onclick="showModal('modal-about')" class="bg-white p-4 rounded-xl shadow-md text-center cursor-pointer hover:bg-green-50 transition border-b-4 border-green-600">
                <i class="fas fa-seedling text-2xl text-green-600 mb-2"></i>
                <div class="text-xs md:text-sm font-bold text-gray-700">關於我們</div>
            </div>
            <div onclick="showModal('modal-rules')" class="bg-white p-4 rounded-xl shadow-md text-center cursor-pointer hover:bg-red-50 transition border-b-4 border-red-500">
                <i class="fas fa-clipboard-check text-2xl text-red-500 mb-2"></i>
                <div class="text-xs md:text-sm font-bold text-gray-700">營區須知</div>
            </div>
            <div onclick="showModal('modal-bank')" class="bg-white p-4 rounded-xl shadow-md text-center cursor-pointer hover:bg-yellow-50 transition border-b-4 border-yellow-500">
                <i class="fas fa-university text-2xl text-yellow-500 mb-2"></i>
                <div class="text-xs md:text-sm font-bold text-gray-700">匯款資訊</div>
            </div>
        </div>

        <div class="mb-8 fade-in" style="animation-delay: 0.1s;">
            <div class="bg-[#06C755] rounded-2xl shadow-lg p-6 text-white flex flex-col md:flex-row items-center justify-between gap-4 relative overflow-hidden">
                <i class="fab fa-line absolute -right-6 -bottom-6 text-8xl opacity-10 rotate-12"></i>
                <div class="flex items-center gap-4 z-10">
                    <div class="bg-white p-3 rounded-full text-[#06C755] shadow-sm animate-bounce">
                        <i class="fab fa-line text-3xl"></i>
                    </div>
                    <div>
                        <h3 class="text-lg md:text-xl font-bold">加入 LINE@ 好友，領取優惠！記得回來用優惠券名稱結帳唷!</h3>
                        <p class="text-green-50 text-sm">輸入代碼 <span class="font-bold text-yellow-200">LINE100</span> 或優惠券名稱，立即折抵 $100</p>
                    </div>
                </div>
                <a href="https://lin.ee/t1Ds7Hq" target="_blank" class="z-10 bg-white text-[#06C755] px-6 py-2 rounded-full font-bold hover:bg-yellow-50 transition shadow-md text-sm border border-transparent hover:border-[#06C755]">
                    <i class="fas fa-gift mr-1"></i> 立即領取
                </a>
            </div>
        </div>
        
        <div class="bg-white rounded-3xl shadow-xl overflow-hidden fade-in" style="animation-delay: 0.2s;">
            <div class="bg-green-700 p-4 text-white text-center">
                <h3 class="font-bold text-lg">線上預訂單</h3>
            </div>

            <form id="bookingForm" class="p-6 space-y-8">
                <input type="hidden" name="sheetName" value="訂單資料">
                
                <div>
                    <h4 class="text-lg font-bold text-stone-800 mb-4 border-l-4 border-green-600 pl-3">基本資料</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1">訂位大名</label>
                            <input type="text" name="訂位大名" required class="w-full bg-stone-50 border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-green-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1">聯絡電話</label>
                            <input type="tel" name="聯絡電話" required class="w-full bg-stone-50 border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-green-500 outline-none">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-xs font-bold text-gray-500 mb-1">Line ID</label>
                            <input type="text" name="Line ID" required class="w-full bg-stone-50 border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-green-500 outline-none" placeholder="方便我們聯繫您">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1">入住日期 <span class="text-red-500 text-xs">(2026/2/1 後開放)</span></label>
                            <input type="date" id="checkinDate" name="入住日期" required min="2026-02-01" class="w-full bg-stone-50 border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-green-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-gray-500 mb-1">退房日期</label>
                            <div class="flex items-center gap-2">
                                <input type="date" id="checkoutDate" name="退房日期" required min="2026-02-02" class="w-full bg-stone-50 border border-gray-300 rounded-lg p-3 focus:ring-2 focus:ring-green-500 outline-none">
                                <span id="stayDays" class="text-sm font-bold text-green-600 whitespace-nowrap hidden"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <hr class="border-gray-200">

                <div>
                    <div class="flex flex-col md:flex-row justify-between items-center mb-4">
                        <h4 class="text-lg font-bold text-stone-800 border-l-4 border-green-600 pl-3 mb-2 md:mb-0">選擇營位</h4>
                        <div class="flex gap-2 overflow-x-auto no-scrollbar w-full md:w-auto p-1 bg-stone-100 rounded-lg">
                            <button type="button" onclick="filterZones('all')" class="filter-btn active px-3 py-1 rounded-md text-xs font-bold transition-all text-gray-500 whitespace-nowrap">全部</button>
                            <button type="button" onclick="filterZones('shelter')" class="filter-btn px-3 py-1 rounded-md text-xs font-bold transition-all text-gray-500 whitespace-nowrap">雨棚區</button>
                            <button type="button" onclick="filterZones('room')" class="filter-btn px-3 py-1 rounded-md text-xs font-bold transition-all text-gray-500 whitespace-nowrap">住宿/懶人</button>
                            <button type="button" onclick="filterZones('grass')" class="filter-btn px-3 py-1 rounded-md text-xs font-bold transition-all text-gray-500 whitespace-nowrap">草地/碎石</button>
                        </div>
                    </div>
                    
                    <input type="hidden" name="預訂區域" id="selectedZoneInput" required>
                    <input type="hidden" id="selectedZonePrice" value="0"> 
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4" id="zoneContainer">
                        </div>

                    <div class="mt-6">
                        <label class="block text-xs font-bold text-gray-500 mb-1">預訂數量 (帳/間)</label>
                        <select name="預訂數量" id="quantitySelect" class="w-full md:w-1/3 bg-stone-50 border border-gray-300 rounded-lg p-3 outline-none">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                        </select>
                    </div>
                </div>

                <hr class="border-gray-200">

                <div class="bg-orange-50 border border-orange-200 rounded-xl p-4">
                    <div class="flex flex-col md:flex-row items-center gap-4">
                        <div class="w-full md:w-32 h-24 flex-shrink-0 rounded-lg overflow-hidden">
                            <img src="https://i.ibb.co/N623cTjr/1299.png" alt="3人份烤肉套餐" class="w-full h-full object-cover">
                        </div>
                        <div class="flex-1">
                            <h4 class="font-bold text-orange-800 text-lg flex items-center">
                                <i class="fas fa-fire mr-2"></i> 加購：3人份烤肉套餐 ($1299)
                            </h4>
                            <p class="text-xs text-orange-600 mt-1">食材豐富，懶人露營首選！費用將合併計算。</p>
                        </div>
                        <div class="w-full md:w-auto">
                            <label class="block text-xs font-bold text-orange-800 mb-1">選擇份數</label>
                            <select name="加購烤肉" id="bbqSelect" class="w-full bg-white border border-orange-300 rounded-lg p-2 outline-none text-orange-900 font-bold">
                                <option value="0">不需要</option>
                                <option value="1">1 份 (+$1299)</option>
                                <option value="2">2 份 (+$2598)</option>
                                <option value="3">3 份 (+$3897)</option>
                                <option value="4">4 份 (+$5196)</option>
                                <option value="5">5 份 (+$6495)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <hr class="border-gray-200">

                <div class="bg-green-50 border border-green-200 rounded-xl p-4">
                    <label class="block text-xs font-bold text-green-800 mb-1"><i class="fas fa-tags mr-1"></i> 優惠折扣碼 (LINE好友專屬)</label>
                    <div class="flex gap-2">
                        <input type="text" id="discountCodeInput" name="折扣碼" placeholder="請輸入代碼或券名" class="flex-1 bg-white border border-green-300 rounded-lg p-2 outline-none focus:ring-2 focus:ring-green-500">
                        <button type="button" onclick="applyDiscount()" class="bg-green-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-500 transition">套用</button>
                    </div>
                    <p id="discountMsg" class="text-xs mt-2 text-gray-500 h-4"></p>
                    <input type="hidden" name="折扣金額" id="discountValue" value="0">
                </div>

                <hr class="border-gray-200">

                <div>
                    <h4 class="text-lg font-bold text-stone-800 mb-4 border-l-4 border-green-600 pl-3">特殊需求</h4>
                    <textarea name="備註需求" placeholder="例如：我是特斯拉車主需要充電 (請提供車號)、需要租借裝備、烤肉用餐時間..." class="w-full bg-stone-50 border border-gray-300 rounded-lg p-3 h-24 focus:ring-2 focus:ring-green-500 outline-none resize-none"></textarea>
                </div>

                <div id="priceCalcResult" class="hidden bg-yellow-50 border border-yellow-200 p-4 rounded-xl">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-sm text-gray-600">小計</span>
                        <span class="text-sm font-bold text-gray-800" id="subtotalDisplay">$0</span>
                    </div>
                    <div class="flex justify-between items-center mb-2" id="discountRow" style="display:none;">
                        <span class="text-sm text-green-600">折扣</span>
                        <span class="text-sm font-bold text-green-600" id="discountDisplay">-$0</span>
                    </div>
                    <hr class="border-yellow-200 mb-2">
                    <div class="flex justify-between items-center">
                        <div>
                            <span class="block text-gray-600 font-bold text-sm">預估總金額</span>
                            <span class="text-xs text-gray-500" id="priceFormula"></span>
                        </div>
                        <div class="text-2xl font-extrabold text-red-600" id="totalPriceDisplay">$0</div>
                    </div>
                </div>

                <button type="submit" id="submitBtn" class="w-full bg-stone-800 text-white font-bold py-4 rounded-xl text-lg shadow-lg hover:bg-stone-700 transition transform hover:scale-[1.01] active:scale-95">
                    確認送出預訂
                </button>
                <p class="text-center text-xs text-gray-400 mt-2">點擊送出即代表同意營區須知</p>

            </form>
        </div>
    </main>

    <footer class="bg-stone-900 text-stone-400 py-8 text-center text-sm">
        <p class="mb-2 text-white font-bold text-lg"><i class="fas fa-bolt text-yellow-400 mr-2"></i> 宜蘭礁溪充電莊</p>
        <p class="mb-4">宜蘭縣礁溪鄉匏杓崙路150之8號</p>
        <div class="flex justify-center gap-4 mb-4">
            <a href="#" class="w-8 h-8 rounded-full bg-stone-700 flex items-center justify-center hover:bg-blue-600 hover:text-white transition"><i class="fab fa-facebook-f"></i></a>
            <a href="https://lin.ee/t1Ds7Hq" target="_blank" class="w-8 h-8 rounded-full bg-stone-700 flex items-center justify-center hover:bg-[#06C755] hover:text-white transition"><i class="fab fa-line"></i></a>
            <a href="#" class="w-8 h-8 rounded-full bg-stone-700 flex items-center justify-center hover:bg-red-500 hover:text-white transition"><i class="fas fa-map-marker-alt"></i></a>
        </div>
        <p>© 2025 Charging Manor.</p>
    </footer>

    <div id="modal-report" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4"><div class="absolute inset-0 bg-black/60" onclick="closeAll()"></div><div class="bg-white w-full max-w-md rounded-2xl shadow-xl z-10 p-6 relative"><button onclick="closeAll()" class="absolute top-4 right-4 text-gray-400"><i class="fas fa-times"></i></button><h3 class="text-xl font-bold mb-4 text-center text-yellow-600">匯款回報</h3><form id="paymentForm" class="space-y-4"><input type="hidden" name="sheetName" value="匯款紀錄"><div><label class="block text-xs font-bold text-gray-500 mb-1">匯款姓名</label><input type="text" name="匯款姓名" required class="w-full border rounded p-2"></div><div><label class="block text-xs font-bold text-gray-500 mb-1">帳號末五碼</label><input type="text" name="末五碼" required class="w-full border rounded p-2"></div><div><label class="block text-xs font-bold text-gray-500 mb-1">匯款金額</label><input type="number" name="匯款金額" required class="w-full border rounded p-2"></div><div><label class="block text-xs font-bold text-gray-500 mb-1">匯款日期</label><input type="date" name="匯款日期" required class="w-full border rounded p-2"></div><button type="submit" id="payBtn" class="w-full bg-yellow-500 text-stone-900 font-bold py-3 rounded-lg hover:bg-yellow-400">送出回報</button></form></div></div>
    <div id="modal-bank" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4"><div class="absolute inset-0 bg-black/60" onclick="closeAll()"></div><div class="bg-white w-full max-w-md rounded-2xl shadow-xl z-10 p-6 relative"><button onclick="closeAll()" class="absolute top-4 right-4 text-gray-400"><i class="fas fa-times"></i></button><h3 class="text-xl font-bold mb-4 text-center">匯款資訊</h3><div class="bg-yellow-50 p-4 rounded-xl border border-yellow-200"><p class="text-sm text-gray-600">銀行：<span class="font-bold text-black">823 將來銀行</span></p><p class="text-sm text-gray-600 mt-2">戶名：<span class="font-bold text-black">林均鴻</span></p><p class="text-sm text-gray-600 mt-2">帳號：</p><p class="text-xl font-mono font-bold text-blue-800 bg-white p-2 rounded border mt-1 text-center">8865-0975-0204-25</p></div><p class="text-xs text-center text-gray-400 mt-4">匯款後請點選選單「匯款回報」</p></div></div>
    <div id="modal-about" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4"><div class="absolute inset-0 bg-black/60" onclick="closeAll()"></div><div class="bg-white w-full max-w-lg rounded-2xl shadow-xl z-10 p-6 relative max-h-[80vh] overflow-y-auto"><button onclick="closeAll()" class="absolute top-4 right-4 text-gray-400"><i class="fas fa-times"></i></button><h3 class="text-xl font-bold mb-4 text-green-700">關於充電莊</h3><p class="mb-4 text-gray-700 leading-relaxed">充電莊，隱在宜蘭礁溪深溝的山腰，像一首還未被唱起的祕密詩。

清晨，龜山島還在沉睡，第一道光便把草地鍍成淡金；傍晚，落羽松鋪出紅毯，夕陽把時間調成慢動作——風掠過耳邊，煩惱便被帶走。

這裡沒有繁複造景，只有蟲鳴、潮聲與95%的雨棚營位。下雨不淋，烈日不曬，懶人躺平，孩子放電。

插上充電槍，泡一壺茶，坐進彩色木椅，看電量回滿，看光線擁吻山海，看孩子追螢火蟲，像追著整個夏天。

2025年，我露營了七十七次，才懂真正的奢侈是：有風有雨不狼狽，有星有月不孤單。

於是我接下了充電莊——這裡不是我的營地，是我兒子的王國，也是每一個電量歸零的人，最後的避風港。

若有一天，你開上山路，電量亮紅，請再往前一點點。你會看見落羽松在搖，燈在亮，茶香飄來，孩子笑著奔跑。那一刻，你就到了。

這裡允許你把電放完，也把心充滿；允許你懶，也允許你盡情奔跑。

願你來到充電莊，在龜山島的日出裡醒來，在落羽松的晚霞裡入睡，在雨棚聽一場夜雨，在螢火蟲與孩子的笑聲裡，找回屬於你的那座山。

「山中若有眠，夢裡總是青。」這裡，就是那個讓人安心入眠的山。

充電莊營主
2025年冬，第78次露營的深夜
風很輕，月正圓，兒子已睡。</p><div class="mt-4 p-3 bg-green-50 rounded text-green-800 font-bold border-l-4 border-green-600">希望來到充電莊的你們，也能跟我一樣，找到屬於自己的那座山。</div></div></div>
    <div id="modal-rules" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4"><div class="absolute inset-0 bg-black/60" onclick="closeAll()"></div><div class="bg-white w-full max-w-lg rounded-2xl shadow-xl z-10 p-6 relative max-h-[80vh] overflow-y-auto"><button onclick="closeAll()" class="absolute top-4 right-4 text-gray-400"><i class="fas fa-times"></i></button><h3 class="text-xl font-bold mb-4 text-red-600">營區須知</h3><ul class="list-disc pl-5 space-y-2 text-sm text-gray-700"><li>1.請注意寧靜時間為每天晚上10點後，請放低音量。<li>2.電動車車主請務必於表單備註，將優先安排充電位置（全區共 17 台）。<li>3.焚火請務必自備木柴、防火布及焚火爐，禁止直接在地面生火。<li>4.本營區不禁菸，但吸煙者請移步至接待處附近指定區域抽煙。<li>5.若進行溪邊活動將分組，可自行帶補蝦籠，有機會抓到溪蝦 (請注意安全)。<li>6.夜衝自搭帳及車泊每帳 $600；民宿、小木屋、露營車及 T 250 為 5 折優惠。夜衝時間為 17:00-22:00。<li>7.營區有各項設備可出租，詳細項目及金額請查看裝備表。
<li>8.用電設備不特定限制，每座插座規格為 15-20A。</li></ul></div></div>
    <div id="modal-bbq" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4"><div class="absolute inset-0 bg-black/60" onclick="closeAll()"></div><div class="bg-white w-full max-w-md rounded-2xl shadow-xl z-10 p-6 relative"><button onclick="closeAll()" class="absolute top-4 right-4 text-gray-400"><i class="fas fa-times"></i></button><h3 class="text-xl font-bold mb-4 text-orange-600">烤肉預定</h3><div class="bg-orange-50 p-4 rounded border border-orange-200 text-center"><h4 class="font-bold text-lg">基本 3 人套餐</h4><p class="text-3xl font-bold text-red-600 my-2">$1,299</p></div></div></div>
    <div id="modal-gear" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4"><div class="absolute inset-0 bg-black/60" onclick="closeAll()"></div><div class="bg-white w-full max-w-lg rounded-2xl shadow-xl z-10 p-6 relative max-h-[80vh] overflow-y-auto"><button onclick="closeAll()" class="absolute top-4 right-4 text-gray-400"><i class="fas fa-times"></i></button><h3 class="text-xl font-bold mb-4 text-blue-600">裝備出租</h3><table class="w-full text-sm text-left"><tbody id="gearTableBody" class="divide-y"></tbody></table></div></div>
    <div id="modal-tent" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4"><div class="absolute inset-0 bg-black/60" onclick="closeAll()"></div><div class="bg-white w-full max-w-md rounded-2xl shadow-xl z-10 p-6 relative"><button onclick="closeAll()" class="absolute top-4 right-4 text-gray-400"><i class="fas fa-times"></i></button><h3 class="text-xl font-bold mb-4 text-purple-600">免搭帳服務</h3><div class="bg-purple-50 p-4 rounded text-center mb-4"><span class="block font-bold text-purple-900">代搭 + 收服務費</span><span class="text-2xl font-bold text-purple-600">$500</span></div><ul class="space-y-2 text-sm text-gray-700"><li class="flex justify-between"><span>迪卡儂 4.2 充氣帳</span><span class="font-bold">$800</span></li><li class="flex justify-between"><span>挪客屋脊 6</span><span class="font-bold">$600</span></li><li class="flex justify-between"><span>IF 充氣帳篷 6.0</span><span class="font-bold">$800</span></li><li class="flex justify-between"><span>杜邦鯤9車尾帳</span><span class="font-bold">$1,000</span></li><li class="flex justify-between text-purple-700 font-bold"><span>KZM-T250</span><span>$2,000</span></li></ul></div></div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbwo6cDMssq7rnjn6-7LvdCFcJGgqKduOEiiSTXUUIS_O2wD4A09a-E8b4-AzfCc2rSf/exec'; 
        const adminSheetURL = 'https://docs.google.com/spreadsheets/d/1frnxcFu6ZvYjUaSRpbq84ROjWYIY4mrHLDyjR1InyXg/edit?gid=0#gid=0';
        
        // ★★★ 擴充的優惠代碼 (名稱即代碼) ★★★
        const discountCodes = {
            'LINE100': 100,
            '首次加入好友': 100,
            '首次加入好友優惠券': 100,
            '首次加入好友禮': 100,
            'TESLA2026': 100,
            'Chunhunglinonly': 9999999
        };

        const zones = [
            { id: 'ZA1', name: '棚架 A 區', count: 9, cat: 'shelter', desc: '寬敞遮雨棚車停帳邊 (9帳)', price: 1200, badge: '熱門', images: ['https://i.ibb.co/KjBcKGvt/A-DDcar.jpg', 'https://i.ibb.co/RTypZTzW/A1.jpg', 'https://i.ibb.co/hRNQ84SY/A.jpg'], idx: 0 },
            { id: 'ZA2', name: '棚架 B 區', count: 4, cat: 'shelter', desc: '適合包區車停帳邊 (4帳)', price: 1200, badge: '包區熱門', images: ['https://i.ibb.co/bMQ51htS/B.jpg', 'https://i.ibb.co/7JY7xRYp/B.jpg'], idx: 0 },
            { id: 'ZA3', name: '棚架 C 區', count: 3, cat: 'shelter', desc: '安靜舒適獨立區車停帳邊 (3帳)', price: 1200, badge: '清靜悠閒', images: ['https://i.ibb.co/c70KNkJ/C1.jpg', 'https://i.ibb.co/zTRCxcwq/2.jpg'], idx: 0 },
            { id: 'ZB1', name: '棧板 A 區', count: 3, cat: 'grass', desc: '架高防潮+遊戲區 (3帳)', price: 1200, badge: '', images: ['https://i.ibb.co/XrMggq46/1.jpg'], idx: 0 },
            { id: 'ZB2', name: '棧板 B 區', count: 2, cat: 'grass', desc: '棚架下的慵懶 (2帳)', price: 1200, badge: '超大空間', images: ['https://i.ibb.co/JRmcf3bw/B.jpg'], idx: 0 },
            { id: 'ZC1', name: '三人頂級露營車', count: 2, cat: 'room', desc: '最有溫度的一晚 (2台)', price: 6980, badge: '送烤肉', images: ['https://i.ibb.co/jvXBxJWw/4.jpg'], idx: 0 },
            { id: 'ZC2', name: '小木屋 (大)', count: 1, cat: 'room', desc: '家庭首選 (1間)', price: 2500, badge: '最夯首選', images: ['https://i.ibb.co/4n2CPt5X/image.jpg', 'https://i.ibb.co/VYpvt7NF/image.jpg'], idx: 0 },
            { id: 'ZC3', name: '小木屋 (小)', count: 1, cat: 'room', desc: '溫馨三人 (1間)', price: 2200, badge: '', images: ['https://i.ibb.co/CpNgsKHw/image.jpg', 'https://i.ibb.co/VW4t8GH4/image.jpg'], idx: 0 },
            { id: 'ZD1', name: '草地區', count: 5, cat: 'grass', desc: '親近自然的美好車停帳邊 (5帳)', price: 1200, badge: '自然紮營', images: ['https://i.ibb.co/7xsg5nfv/1.jpg', 'https://i.ibb.co/DDLBdhNk/3.jpg', 'https://i.ibb.co/S73TLHJR/2.jpg'], idx: 0 },
            { id: 'ZD2', name: '碎石地區', count: 2, cat: 'grass', desc: '充電紮營首選車停帳邊 (2帳)', price: 1200, badge: '碎石美好', images: ['https://i.ibb.co/k6D740Ht/image.jpg'], idx: 0 },
            { id: 'ZE1', name: '包棟民宿 (16人)', count: 1, cat: 'room', desc: '4房/多人K歌最開心 (1棟)', price: 18000, badge: '獨享群樂', images: ['https://i.ibb.co/6RyZYPVy/7-KW.jpg'], idx: 0 },
            { id: 'ZF1', name: '泰式免搭', count: 8, cat: 'room', desc: '懶人新福音 (8帳)', price: 1200, badge: '最新', images: ['https://i.ibb.co/60bXNB57/image.jpg', 'https://i.ibb.co/DHhm1sWR/2.jpg'], idx: 0 }
        ];

        const gears = [{n:'月亮椅/休閒椅',p:'100'},{n:'平躺椅',p:'150'},{n:'卡式爐/蜘蛛爐(含瓦斯)',p:'200'},{n:'五星爐(含瓦斯)',p:'300'},{n:'IGT桌全套',p:'600'},{n:'天幕 3*3+桿',p:'250'},{n:'天幕 3*5+桿',p:'350'},{n:'超聲波地墊 3*3',p:'150'},{n:'野餐地墊 2*2/燈具',p:'100'},{n:'落地頂級四葉燈',p:'350'},{n:'杜邦鯤9車尾帳',p:'1000'},{n:'代搭帳服務',p:'500'},{n:'投影機',p:'300'},{n:'投影布幕',p:'100'},{n:'電暖器/焚火台(鐵)',p:'200'},{n:'焚火台(純鈦)',p:'350'},{n:'木柴',p:'100'}];

        let currentDiscount = 0;

        function init() { renderZones('all'); renderGears(); setupCalculator(); }

        window.applyDiscount = () => {
            const code = document.getElementById('discountCodeInput').value.trim(); // 移除 toUpperCase 以支援中文
            const msg = document.getElementById('discountMsg');
            const discountRow = document.getElementById('discountRow');
            const discountDisplay = document.getElementById('discountDisplay');
            const discountInput = document.getElementById('discountValue');

            if (discountCodes.hasOwnProperty(code)) {
                currentDiscount = discountCodes[code];
                msg.innerHTML = `<span class="text-green-600"><i class="fas fa-check-circle"></i> 優惠代碼有效！折抵 $${currentDiscount}</span>`;
                discountRow.style.display = 'flex';
                discountDisplay.innerText = `-$${currentDiscount}`;
                discountInput.value = currentDiscount;
            } else {
                currentDiscount = 0;
                msg.innerHTML = `<span class="text-red-500"><i class="fas fa-times-circle"></i> 無效的代碼</span>`;
                discountRow.style.display = 'none';
                discountInput.value = 0;
            }
            // 觸發重新計算
            const event = new Event('change');
            document.getElementById('quantitySelect').dispatchEvent(event);
        }

        function setupCalculator() {
            const inDate = document.getElementById('checkinDate');
            const outDate = document.getElementById('checkoutDate');
            const qtySelect = document.getElementById('quantitySelect');
            const bbqSelect = document.getElementById('bbqSelect');
            const zoneInput = document.getElementById('selectedZoneInput');
            const zonePriceInput = document.getElementById('selectedZonePrice');
            const resultDiv = document.getElementById('priceCalcResult');
            const formulaSpan = document.getElementById('priceFormula');
            const totalDisplay = document.getElementById('totalPriceDisplay');
            const subtotalDisplay = document.getElementById('subtotalDisplay');
            const stayDaysSpan = document.getElementById('stayDays');

            function calculate() {
                const zoneName = zoneInput.value;
                const price = parseInt(zonePriceInput.value) || 0;
                const qty = parseInt(qtySelect.value) || 1;
                const bbqQty = parseInt(bbqSelect.value) || 0;
                const bbqPrice = 1299;
                let days = 0;

                if (inDate.value && outDate.value) {
                    const start = new Date(inDate.value);
                    const end = new Date(outDate.value);
                    const diffTime = end - start;
                    days = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    if (days > 0) {
                        stayDaysSpan.textContent = `共 ${days} 晚`;
                        stayDaysSpan.classList.remove('hidden');
                    } else {
                        stayDaysSpan.classList.add('hidden');
                        days = 0; 
                    }
                }

                if (zoneName && days > 0) {
                    const roomTotal = price * qty * days;
                    const bbqTotal = bbqPrice * bbqQty;
                    const subtotal = roomTotal + bbqTotal;
                    const finalTotal = subtotal - currentDiscount;
                    
                    resultDiv.classList.remove('hidden');
                    subtotalDisplay.innerText = `$${subtotal.toLocaleString()}`;
                    
                    let formulaText = `${qty}帳 × ${days}晚`;
                    if (bbqQty > 0) formulaText += ` + 烤肉${bbqQty}份`;
                    if (currentDiscount > 0) formulaText += ` - 折扣$${currentDiscount}`;
                    
                    formulaSpan.textContent = formulaText;
                    totalDisplay.textContent = `$${Math.max(0, finalTotal).toLocaleString()}`;
                } else {
                    resultDiv.classList.add('hidden');
                }
            }

            inDate.addEventListener('change', calculate);
            outDate.addEventListener('change', calculate);
            qtySelect.addEventListener('change', calculate);
            bbqSelect.addEventListener('change', calculate);
        }

        function renderZones(filter) {
            const container = document.getElementById('zoneContainer');
            container.innerHTML = '';
            
            zones.forEach(zone => {
                if(filter !== 'all' && zone.cat !== filter) return;
                const div = document.createElement('div');
                div.className = `zone-card bg-white rounded-xl p-3 cursor-pointer relative overflow-hidden flex items-center h-32 md:h-36`;
                
                const badge = zone.badge ? `<span class="absolute top-0 right-0 bg-yellow-400 text-stone-900 text-xs font-bold px-2 py-1 rounded-bl-lg z-20 shadow-sm">${zone.badge}</span>` : '';
                
                const imgWrap = document.createElement('div');
                imgWrap.className = "w-32 h-full md:w-40 flex-shrink-0 rounded-lg overflow-hidden relative mr-4";
                
                const img = document.createElement('img');
                img.src = zone.images[zone.idx];
                img.className = "w-full h-full object-cover transition duration-500 hover:scale-110";
                
                if (zone.images.length > 1) {
                    imgWrap.classList.add('cursor-change-image');
                    imgWrap.title = "點擊切換圖片";
                    const tip = document.createElement('div');
                    tip.className = "absolute bottom-1 right-1 bg-black/60 text-white text-[10px] px-1.5 rounded pointer-events-none";
                    tip.innerText = "點圖切換";
                    imgWrap.appendChild(tip);
                    imgWrap.addEventListener('click', (e) => {
                        e.stopPropagation();
                        zone.idx = (zone.idx + 1) % zone.images.length;
                        img.src = zone.images[zone.idx];
                    });
                }
                imgWrap.prepend(img);

                const info = document.createElement('div');
                info.className = "flex-1";
                info.innerHTML = `
                    <h3 class="font-bold text-stone-800 text-lg leading-tight mb-1">${zone.name}</h3>
                    <p class="text-xs text-gray-500 font-medium mb-2">${zone.desc}</p>
                    <p class="text-green-600 font-bold text-lg">$${zone.price.toLocaleString()} <span class="text-xs text-gray-400 font-normal">/ 晚</span></p>
                `;
                div.innerHTML = badge;
                div.appendChild(imgWrap);
                div.appendChild(info);
                div.onclick = () => {
                    document.querySelectorAll('.zone-card').forEach(c => c.classList.remove('selected'));
                    div.classList.add('selected');
                    document.getElementById('selectedZoneInput').value = zone.name;
                    document.getElementById('selectedZonePrice').value = zone.price;
                    const event = new Event('change');
                    document.getElementById('checkinDate').dispatchEvent(event);
                };
                container.appendChild(div);
            });
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if(btn.onclick.toString().includes(`'${filter}'`)) {
                    btn.classList.add('active', 'text-white', 'bg-green-700');
                    btn.classList.remove('text-gray-500');
                } else {
                    btn.classList.remove('active', 'text-white', 'bg-green-700');
                    btn.classList.add('text-gray-500');
                }
            });
        }
        
        window.filterZones = (cat) => renderZones(cat);
        function renderGears() {
            const tbody = document.getElementById('gearTableBody');
            let html = '';
            gears.forEach(g => {
                html += `<tr class="border-b"><td class="px-4 py-2 text-stone-700">${g.n}</td><td class="px-4 py-2 text-right font-bold text-blue-600">$${g.p}</td></tr>`;
            });
            tbody.innerHTML = html;
        }
        window.toggleSidebar = () => {
            const sb = document.getElementById('sidebar');
            const ov = document.getElementById('overlay');
            if(sb.classList.contains('-translate-x-full')) {
                sb.classList.remove('-translate-x-full');
                ov.classList.remove('hidden');
            } else {
                sb.classList.add('-translate-x-full');
                ov.classList.add('hidden');
            }
        };
        window.showModal = (id) => {
            document.getElementById('sidebar').classList.add('-translate-x-full');
            document.getElementById('overlay').classList.remove('hidden');
            document.querySelectorAll('[id^="modal-"]').forEach(el => el.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        };
        window.closeAll = () => {
            document.getElementById('sidebar').classList.add('-translate-x-full');
            document.getElementById('overlay').classList.add('hidden');
            document.querySelectorAll('[id^="modal-"]').forEach(el => el.classList.add('hidden'));
        };
        window.adminLogin = () => {
            const pwd = prompt("請輸入營主密碼：");
            if (pwd === "Hank0219") {
                window.open(adminSheetURL, '_blank');
            } else if (pwd !== null) alert("密碼錯誤");
        };

        // 訂位表單送出 (含折扣碼)
        document.getElementById('bookingForm').addEventListener('submit', e => {
            e.preventDefault();
            const input = document.getElementById('selectedZoneInput');
            if(!input.value) { alert('請先選擇一個營位區域！'); return; }

            const btn = document.getElementById('submitBtn');
            const originalText = btn.innerText;
            btn.disabled = true;
            btn.innerText = '處理中...';

            const formData = new FormData(e.target);
            
            const inDateStr = document.getElementById('checkinDate').value;
            const outDateStr = document.getElementById('checkoutDate').value;
            const price = parseInt(document.getElementById('selectedZonePrice').value) || 0;
            const qty = parseInt(document.getElementById('quantitySelect').value) || 1;
            const bbqQty = parseInt(document.getElementById('bbqSelect').value) || 0;
            
            if(inDateStr && outDateStr) {
                const start = new Date(inDateStr);
                const end = new Date(outDateStr);
                const diffTime = end - start;
                const days = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                const subtotal = (price * qty * days) + (1299 * bbqQty);
                const total = Math.max(0, subtotal - currentDiscount);
                
                formData.append('入住天數', days);
                formData.append('總金額', total);
                // 折扣碼 input 已在 form 中 (name="折扣碼")
            }

            fetch(scriptURL, { 
                method: 'POST', 
                body: formData,
                mode: 'no-cors' 
            })
            .then(() => {
                alert('✅ 預訂送出成功！\n我們已收到您的資料，將盡快安排並聯繫您。');
                e.target.reset();
                document.querySelectorAll('.zone-card').forEach(c => c.classList.remove('selected'));
                input.value = '';
                document.getElementById('selectedZonePrice').value = '0';
                document.getElementById('priceCalcResult').classList.add('hidden');
                document.getElementById('stayDays').classList.add('hidden');
                // 重置折扣
                currentDiscount = 0;
                document.getElementById('discountMsg').innerHTML = '';
                document.getElementById('discountRow').style.display = 'none';
                
                zones.forEach(z => z.idx = 0);
                renderZones('all');
            })
            .catch(err => {
                alert('❌ 發生錯誤，請截圖聯繫營主！\n錯誤訊息: ' + err.message);
                console.error(err);
            })
            .finally(() => {
                btn.disabled = false;
                btn.innerText = originalText;
            });
        });

        // 匯款回報表單送出
        document.getElementById('paymentForm').addEventListener('submit', e => {
            e.preventDefault();
            const btn = document.getElementById('payBtn');
            const originalText = btn.innerText;
            btn.disabled = true;
            btn.innerText = '傳送中...';

            fetch(scriptURL, { 
                method: 'POST', 
                body: new FormData(e.target),
                mode: 'no-cors'
            })
            .then(() => {
                alert('✅ 匯款回報成功！\n我們將盡快為您對帳。');
                e.target.reset();
                closeAll();
            })
            .catch(err => {
                alert('❌ 發生錯誤，請直接聯繫營主！\n錯誤訊息: ' + err.message);
            })
            .finally(() => {
                btn.disabled = false;
                btn.innerText = originalText;
            });
        });

        init();
    </script>
</body>
</html>