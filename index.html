<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>宜蘭礁溪充電莊 - 官方預訂平台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* 確保 body 沒有預設邊距 */
        body, html { margin: 0; padding: 0; overflow-x: hidden; width: 100%; }

        /* 卡片特效 */
        .zone-card { transition: all 0.3s ease; }
        .zone-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.15); }
        .selected { border: 2px solid #059669; transform: scale(1.02); box-shadow: 0 0 15px rgba(5, 150, 105, 0.2); }
        
        .loading { opacity: 0.7; pointer-events: none; }
        #sidebar { transition: transform 0.3s ease-in-out; }
        .sidebar-open { transform: translateX(0) !important; }
        .modal { transition: opacity 0.3s ease; }
        
        /* 將來銀行小卡樣式 */
        .next-bank-card {
            background-color: #FFF100;
            color: #000000;
            border-radius: 1rem;
            overflow: hidden;
            font-family: sans-serif;
        }
    </style>
</head>
<body class="bg-stone-100 text-stone-800 font-sans relative">

    <div id="overlay" onclick="closeAll()" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>

    <nav class="bg-stone-800 text-white p-4 shadow-lg sticky top-0 z-30 flex justify-between items-center transition-colors duration-300 w-full" id="navbar">
        <button onclick="toggleSidebar()" class="text-white hover:text-yellow-400 focus:outline-none">
            <i class="fas fa-bars text-2xl"></i>
        </button>
        <h1 class="text-xl font-bold flex items-center">
            <i class="fas fa-bolt text-yellow-400 mr-2"></i> 宜蘭礁溪充電莊
        </h1>
        <button onclick="openAdminPanel()" class="text-sm bg-yellow-600 text-white px-3 py-1 rounded font-bold hover:bg-yellow-500 transition">
            <i class="fas fa-user-lock"></i> 營主
        </button>
    </nav>

    <div id="sidebar" class="fixed inset-y-0 left-0 w-72 bg-white shadow-2xl transform -translate-x-full z-50 flex flex-col">
        <div class="p-6 bg-stone-800 text-white font-bold text-xl flex justify-between items-center">
            <span>選單導覽</span>
            <button onclick="toggleSidebar()" class="text-gray-400 hover:text-white"><i class="fas fa-times"></i></button>
        </div>
        <div class="flex-1 overflow-y-auto py-4">
            <div class="px-6 mb-4 pb-4 border-b border-gray-200">
                <p class="text-xs text-gray-500 mb-3 font-bold uppercase tracking-wider">會員登入 / 註冊</p>
                <div class="space-y-3">
                    <button onclick="alert('系統已自動綁定手機號碼！請直接填寫訂單，我們會自動累積您的會員次數。')" class="w-full bg-[#06C755] text-white py-2 rounded-lg text-sm font-bold shadow hover:bg-green-600 flex items-center justify-center transition">
                        <i class="fab fa-line text-xl mr-2"></i> Line 帳號登入
                    </button>
                    <button onclick="alert('系統已自動綁定手機號碼！請直接填寫訂單，我們會自動累積您的會員次數。')" class="w-full bg-white border border-gray-300 text-gray-700 py-2 rounded-lg text-sm font-bold shadow-sm hover:bg-gray-50 flex items-center justify-center transition">
                        <i class="fab fa-google text-xl mr-2 text-red-500"></i> Google 帳號登入
                    </button>
                </div>
            </div>
            <nav class="space-y-1">
                <a href="#" onclick="showModal('modal-about')" class="block px-6 py-3 hover:bg-green-50 text-stone-700 border-l-4 border-transparent hover:border-green-500 transition"><i class="fas fa-info-circle w-6 text-green-600"></i> 關於充電莊</a>
                <a href="#" onclick="showModal('modal-rules')" class="block px-6 py-3 hover:bg-green-50 text-stone-700 border-l-4 border-transparent hover:border-green-500 transition"><i class="fas fa-clipboard-list w-6 text-red-600"></i> 營區須知 (含地圖)</a>
                <a href="#" onclick="showModal('modal-bank')" class="block px-6 py-3 hover:bg-yellow-50 text-stone-700 border-l-4 border-transparent hover:border-yellow-500 transition"><i class="fas fa-university w-6 text-yellow-600"></i> 匯款資訊</a>
                <a href="#" onclick="showModal('modal-payment')" class="block px-6 py-3 hover:bg-blue-50 text-blue-800 border-l-4 border-transparent hover:border-blue-600 font-bold transition"><i class="fas fa-file-invoice-dollar w-6"></i> 匯款回報 (填寫)</a>
                <a href="#" onclick="showModal('modal-bbq')" class="block px-6 py-3 hover:bg-green-50 text-stone-700 border-l-4 border-transparent hover:border-green-500 transition"><i class="fas fa-drumstick-bite w-6 text-orange-600"></i> 烤肉預定</a>
                <a href="#" onclick="showModal('modal-gear')" class="block px-6 py-3 hover:bg-green-50 text-stone-700 border-l-4 border-transparent hover:border-green-500 transition"><i class="fas fa-tools w-6 text-blue-600"></i> 裝備出租價目</a>
                <a href="#" onclick="showModal('modal-tent')" class="block px-6 py-3 hover:bg-green-50 text-stone-700 border-l-4 border-transparent hover:border-green-500 transition"><i class="fas fa-campground w-6 text-purple-600"></i> 免搭帳服務</a>
            </nav>
        </div>
        <div class="p-4 text-xs text-gray-500 text-center border-t bg-stone-50">© 2025 宜蘭礁溪充電莊</div>
    </div>

    <div class="container mx-auto p-4 max-w-6xl mt-4 mb-4">
        <div class="relative rounded-2xl overflow-hidden shadow-2xl bg-stone-900">
            <img src="https://i.ibb.co/6cx1xrVR/image.jpg" alt="封面山景" class="w-full h-auto block opacity-80">
            <div class="absolute inset-0 flex flex-col items-center justify-center text-center p-4">
                <div class="text-white max-w-2xl animate-fade-in-up">
                    <h2 class="text-3xl md:text-5xl font-bold mb-3 text-shadow-lg shadow-black drop-shadow-md">歡迎來到充電莊</h2>
                    <p class="text-base md:text-xl opacity-100 mb-4 font-medium drop-shadow-md">特斯拉友善營地 | 親近自然 | 舒適住宿</p>
                    <div class="inline-flex items-center bg-yellow-400 text-yellow-900 px-4 py-1.5 rounded-full text-xs md:text-sm font-bold shadow-lg">
                        <i class="fas fa-star mr-2"></i> 輸入手機號碼，自動累積會員等級
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto p-4 max-w-6xl relative z-10">
        <form id="bookingForm" class="space-y-6">
            <input type="hidden" name="action" value="booking">
            
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-bold mb-4 text-stone-700 border-l-4 border-green-600 pl-3">步驟 1: 預訂資訊</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">訂位大名</label>
                        <input type="text" name="訂位大名" required class="w-full border-gray-300 border rounded-lg p-3 focus:ring-2 focus:ring-green-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">聯絡電話 <span class="text-xs text-green-600">(自動綁定)</span></label>
                        <input type="tel" name="聯絡電話" placeholder="09xxxxxxxx" required class="w-full border-gray-300 border rounded-lg p-3 focus:ring-2 focus:ring-green-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Line ID <span class="text-xs text-gray-400">(選填)</span></label>
                        <input type="text" name="LineID" class="w-full border-gray-300 border rounded-lg p-3 focus:ring-2 focus:ring-green-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">預訂數量</label>
                        <select name="預訂數量" class="w-full border-gray-300 border rounded-lg p-3 bg-white focus:ring-2 focus:ring-green-500 outline-none">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                        </select>
                    </div>
                    
                    <div class="lg:col-span-4 grid grid-cols-1 md:grid-cols-3 gap-4 bg-stone-50 p-4 rounded-lg border border-stone-100 mt-2">
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1"><i class="fas fa-calendar-check mr-1 text-green-600"></i> 入住日期</label>
                            <input type="date" name="入住日期" id="checkinDate" required class="w-full border-gray-300 border rounded-lg p-3 focus:ring-2 focus:ring-green-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1"><i class="fas fa-sign-out-alt mr-1 text-red-500"></i> 退房日期</label>
                            <input type="date" name="退房日期" id="checkoutDate" required class="w-full border-gray-300 border rounded-lg p-3 focus:ring-2 focus:ring-green-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-bold text-gray-700 mb-1"><i class="fas fa-clock mr-1 text-blue-500"></i> 入住天數</label>
                            <input type="text" id="durationDisplay" value="1天1夜" readonly class="w-full bg-gray-200 border-gray-300 border rounded-lg p-3 text-center font-bold text-gray-600 cursor-not-allowed">
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-bold mb-4 text-stone-700 border-l-4 border-green-600 pl-3">步驟 2: 選擇區域</h3>
                <input type="hidden" name="預訂區域" id="selectedZoneInput" required>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="zoneContainer"></div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-bold mb-4 text-stone-700 border-l-4 border-green-600 pl-3">步驟 3: 特殊需求</h3>
                <textarea name="備註需求" placeholder="例如：我是特斯拉車主需要充電、需要租借2張月亮椅、一份烤肉套餐..." class="w-full border-gray-300 border rounded-lg p-3 h-24 focus:ring-2 focus:ring-green-500 outline-none"></textarea>
            </div>

            <button type="submit" id="submitBtn" class="w-full bg-green-600 text-white font-bold py-4 rounded-xl text-lg shadow-lg hover:bg-green-700 transform hover:-translate-y-1 transition duration-200">
                確認預訂
            </button>
        </form>
    </div>

    <div id="modal-rules" class="modal hidden fixed inset-0 z-50 flex items-center justify-center pointer-events-none">
        <div class="bg-white w-11/12 max-w-lg rounded-xl shadow-2xl pointer-events-auto flex flex-col max-h-[90vh]">
            <div class="p-4 border-b flex justify-between items-center bg-stone-100 rounded-t-xl"><h3 class="font-bold text-lg"><i class="fas fa-clipboard-list text-red-600"></i> 營區須知</h3><button onclick="closeAll()"><i class="fas fa-times"></i></button></div>
            <div class="p-0 overflow-y-auto">
                <img src="https://i.ibb.co/DHK9NKfP/image.png" alt="營區地圖" class="w-full h-auto border-b">
                <div class="p-6">
                    <ol class="list-decimal list-inside space-y-2 text-gray-700 text-sm leading-relaxed">
                        <li>請注意寧靜時間為每天晚上10點後，請放低音量</li>
                        <li>電動車車主請告知於表單，將安排優先充電位置（17台）</li>
                        <li>焚火、需自備木柴/防火布/焚火爐</li>
                        <li>本團不禁菸、吸煙者請到接待處附近抽煙</li>
                        <li>本營區不定期會舉辦活動，歡迎洽詢</li>
                        <li>如果要進行溪邊活動將分組，可自行帶補蝦籠，有機會抓到溪蝦。</li>
                        <li>夜衝自搭帳及車泊每帳$600；民宿、小木屋、露營車、及T 250 為5折優惠假，夜衝時間為下午五點至晚上10點，請盡量在10點前完成搭帳。</li>
                        <li>為維護品質， 10點過後請勿喧鬧，民宿KTV音量請放低，如有問題，歡迎聯繫。</li>
                        <li>營區有設備可出租，詳細項目及金額請洽團主。</li>
                        <li>用電設備不特定限制，每座插座為15-20A</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-about" class="modal hidden fixed inset-0 z-50 flex items-center justify-center pointer-events-none">
        <div class="bg-white w-11/12 max-w-lg rounded-xl shadow-2xl pointer-events-auto flex flex-col max-h-[90vh]">
            <div class="p-4 border-b flex justify-between items-center bg-stone-100 rounded-t-xl"><h3 class="font-bold text-lg"><i class="fas fa-info-circle text-green-600"></i> 關於充電莊</h3><button onclick="closeAll()"><i class="fas fa-times"></i></button></div>
            <div class="p-0 overflow-y-auto">
                 <img src="https://i.ibb.co/p6KgV8n1/image.webp" alt="充電樁" class="w-full h-48 object-cover">
                 <div class="p-6 space-y-4 text-gray-700 leading-relaxed">
                    <p>從一個默默無名的營區走到的現在，充電莊做了非常多的努力，不只讓這裡變成了一個電動車超級友善的露營區，也是許多人淨化心靈的地方。</p>
                    <p>我在2025年，一年之內，完成了77次的露營，吸取了無數的經驗，和無數個營主討論過想法，最後決定接手這個營區。</p>
                    <p>為了我的孩子，我每個禮拜都帶她去露營，讓他多多結交認識朋友，非常社牛的他，每天都可以把電放完，這也讓身為父親的我輕鬆了許多，也淨化了心靈。</p>
                    <p class="font-bold text-green-700 bg-green-50 p-2 rounded">希望來到充電莊的你們，也能跟我一樣，找到屬於自己的那座山。</p>
                 </div>
            </div>
        </div>
    </div>

    <div id="modal-bank" class="modal hidden fixed inset-0 z-50 flex items-center justify-center pointer-events-none">
         <div class="bg-white w-11/12 max-w-md rounded-xl shadow-2xl pointer-events-auto flex flex-col">
            <div class="p-4 border-b flex justify-between items-center bg-stone-100 rounded-t-xl"><h3 class="font-bold text-lg"><i class="fas fa-university text-yellow-600"></i> 匯款資訊</h3><button onclick="closeAll()"><i class="fas fa-times"></i></button></div>
            <div class="p-6 flex flex-col items-center">
                <img src="https://i.ibb.co/bR6zQsFV/image-0-png.jpg" alt="將來銀行匯款資訊" class="w-full max-w-sm shadow-lg rounded-lg mb-4">
                <div class="w-full bg-gray-50 border border-gray-200 rounded-lg p-4 text-sm text-gray-700 space-y-1 mb-2">
                    <p><span class="font-bold text-gray-500 w-12 inline-block">戶名：</span><span class="font-bold">林均鴻</span></p>
                    <p><span class="font-bold text-gray-500 w-12 inline-block">銀行：</span>將來銀行 (823)</p>
                    <p class="flex items-center">
                        <span class="font-bold text-gray-500 w-12 inline-block">帳號：</span>
                        <span class="font-mono font-bold text-blue-700 text-lg">88650975020425</span>
                    </p>
                </div>
                <p class="text-xs text-red-500 mt-2"><i class="fas fa-exclamation-triangle"></i> 匯款後請務必使用「匯款回報」功能通知營主。</p>
            </div>
        </div>
    </div>

    <div id="modal-payment" class="modal hidden fixed inset-0 z-50 flex items-center justify-center pointer-events-none">
        <div class="bg-white w-11/12 max-w-md rounded-xl shadow-2xl pointer-events-auto flex flex-col">
            <div class="p-4 border-b flex justify-between items-center bg-blue-50 rounded-t-xl"><h3 class="font-bold text-lg text-blue-800"><i class="fas fa-file-invoice-dollar"></i> 匯款回報</h3><button onclick="closeAll()"><i class="fas fa-times"></i></button></div>
            <div class="p-6">
                <form id="paymentForm" class="space-y-4">
                    <input type="hidden" name="action" value="payment">
                    <div><label class="block text-sm font-bold text-gray-700 mb-1">匯款人姓名</label><input type="text" name="匯款姓名" required class="w-full border p-2 rounded"></div>
                    <div><label class="block text-sm font-bold text-gray-700 mb-1">帳號末五碼</label><input type="text" name="末五碼" required maxlength="5" class="w-full border p-2 rounded"></div>
                    <div><label class="block text-sm font-bold text-gray-700 mb-1">匯款金額</label><input type="number" name="匯款金額" required class="w-full border p-2 rounded"></div>
                    <div><label class="block text-sm font-bold text-gray-700 mb-1">匯款日期</label><input type="date" name="匯款日期" required class="w-full border p-2 rounded"></div>
                    <button type="submit" id="payBtn" class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition">送出回報</button>
                </form>
            </div>
        </div>
    </div>

    <div id="modal-bbq" class="modal hidden fixed inset-0 z-50 flex items-center justify-center pointer-events-none">
        <div class="bg-white w-11/12 max-w-md rounded-xl shadow-2xl pointer-events-auto flex flex-col">
            <div class="p-4 border-b flex justify-between items-center bg-stone-100 rounded-t-xl"><h3 class="font-bold text-lg"><i class="fas fa-drumstick-bite text-orange-600"></i> 烤肉預定</h3><button onclick="closeAll()"><i class="fas fa-times"></i></button></div>
            <div class="p-6 text-center">
                <div class="bg-orange-50 p-4 rounded-lg border border-orange-200 mb-4">
                    <h4 class="text-xl font-bold text-orange-800 mb-2">基本 3 人套餐</h4>
                    <p class="text-3xl font-bold text-red-600">$1,299</p>
                    <p class="text-sm text-gray-500 mt-2">食材豐富，輕鬆享受露營烤肉趣</p>
                </div>
                <p class="text-sm text-gray-600">※ 請於預訂時在「備註」欄位註明需要幾份。</p>
            </div>
        </div>
    </div>

    <div id="modal-gear" class="modal hidden fixed inset-0 z-50 flex items-center justify-center pointer-events-none">
        <div class="bg-white w-11/12 max-w-xl rounded-xl shadow-2xl pointer-events-auto flex flex-col max-h-[90vh]">
            <div class="p-4 border-b flex justify-between items-center bg-stone-100 rounded-t-xl"><h3 class="font-bold text-lg"><i class="fas fa-tools text-blue-600"></i> 裝備出租價目表</h3><button onclick="closeAll()"><i class="fas fa-times"></i></button></div>
            <div class="p-4 overflow-y-auto">
                <table class="w-full text-sm text-left text-gray-700 border-collapse">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-100 sticky top-0">
                        <tr><th class="px-4 py-2 border-b">品項</th><th class="px-4 py-2 text-right border-b">價格/單位</th></tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200">
                        <tr><td class="px-4 py-2">月亮椅</td><td class="px-4 py-2 text-right font-bold">$100/張</td></tr>
                        <tr><td class="px-4 py-2">休閒椅</td><td class="px-4 py-2 text-right font-bold">$100/張</td></tr>
                        <tr><td class="px-4 py-2">平躺椅</td><td class="px-4 py-2 text-right font-bold">$150/張</td></tr>
                        <tr><td class="px-4 py-2">卡式爐(含瓦斯)</td><td class="px-4 py-2 text-right font-bold">$200/個</td></tr>
                        <tr><td class="px-4 py-2">蜘蛛爐(含瓦斯)</td><td class="px-4 py-2 text-right font-bold">$200/個</td></tr>
                        <tr><td class="px-4 py-2">五星爐(含瓦斯)</td><td class="px-4 py-2 text-right font-bold">$300/個</td></tr>
                        <tr><td class="px-4 py-2">IGT桌(含瓦斯爐*2、瀝水籃、自動上水器、發光桌板)</td><td class="px-4 py-2 text-right font-bold">$600/個</td></tr>
                        <tr><td class="px-4 py-2">天幕3*3+桿</td><td class="px-4 py-2 text-right font-bold">$250/組</td></tr>
                        <tr><td class="px-4 py-2">天幕3*5+桿</td><td class="px-4 py-2 text-right font-bold">$350/組</td></tr>
                        <tr><td class="px-4 py-2">超聲波地墊3*3</td><td class="px-4 py-2 text-right font-bold">$150/個</td></tr>
                        <tr><td class="px-4 py-2">野餐地墊2*2</td><td class="px-4 py-2 text-right font-bold">$100/個</td></tr>
                        <tr><td class="px-4 py-2">燈串</td><td class="px-4 py-2 text-right font-bold">$100/個</td></tr>
                        <tr><td class="px-4 py-2">燈條</td><td class="px-4 py-2 text-right font-bold">$100/個</td></tr>
                        <tr><td class="px-4 py-2">氣氛燈</td><td class="px-4 py-2 text-right font-bold">$100/個</td></tr>
                        <tr><td class="px-4 py-2">落地頂級四葉燈</td><td class="px-4 py-2 text-right font-bold">$350/個</td></tr>
                        <tr><td class="px-4 py-2">杜邦鯤9車尾帳(一房一廳)</td><td class="px-4 py-2 text-right font-bold">$1000/個</td></tr>
                        <tr><td class="px-4 py-2">代搭帳服務</td><td class="px-4 py-2 text-right font-bold">$500/帳</td></tr>
                        <tr><td class="px-4 py-2">投影機</td><td class="px-4 py-2 text-right font-bold">$300/個</td></tr>
                        <tr><td class="px-4 py-2">投影布幕</td><td class="px-4 py-2 text-right font-bold">$100/個</td></tr>
                        <tr><td class="px-4 py-2">頂級投影布幕含支架</td><td class="px-4 py-2 text-right font-bold">$300/個</td></tr>
                        <tr><td class="px-4 py-2">電暖器(黑設)</td><td class="px-4 py-2 text-right font-bold">$200/個</td></tr>
                        <tr><td class="px-4 py-2">焚火台(純鈦)</td><td class="px-4 py-2 text-right font-bold">$350/個</td></tr>
                        <tr><td class="px-4 py-2">焚火台(鐵製)</td><td class="px-4 py-2 text-right font-bold">$200/個</td></tr>
                        <tr><td class="px-4 py-2">木柴</td><td class="px-4 py-2 text-right font-bold">$100/份</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="modal-tent" class="modal hidden fixed inset-0 z-50 flex items-center justify-center pointer-events-none">
        <div class="bg-white w-11/12 max-w-md rounded-xl shadow-2xl pointer-events-auto flex flex-col">
            <div class="p-4 border-b flex justify-between items-center bg-stone-100 rounded-t-xl"><h3 class="font-bold text-lg"><i class="fas fa-campground text-purple-600"></i> 免搭帳服務</h3><button onclick="closeAll()"><i class="fas fa-times"></i></button></div>
            <div class="p-6">
                <div class="bg-purple-50 p-3 rounded mb-3 border border-purple-200 text-center">
                    <span class="block font-bold text-purple-900">代搭 + 收服務費</span>
                    <span class="text-xl font-bold">$500</span>
                </div>
                <ul class="space-y-3 text-sm">
                    <li class="flex justify-between border-b pb-2"><span>迪卡儂4.2充氣帳篷</span><span class="font-bold">$800</span></li>
                    <li class="flex justify-between border-b pb-2"><span>挪客屋脊6</span><span class="font-bold">$600</span></li>
                    <li class="flex justify-between border-b pb-2"><span>IF充氣帳篷6.0</span><span class="font-bold">$800</span></li>
                    <li class="flex justify-between border-b pb-2"><span>杜邦鯤9車尾帳篷 (99%密合Model y)</span><span class="font-bold">$1000</span></li>
                    <li class="flex justify-between border-b pb-2 text-purple-700 font-bold"><span>KZM-T250</span><span>$2000</span></li>
                </ul>
            </div>
        </div>
    </div>

    <div id="modal-admin" class="modal hidden fixed inset-0 z-50 flex items-center justify-center pointer-events-none">
        <div class="bg-white w-11/12 max-w-5xl rounded-xl shadow-2xl pointer-events-auto flex flex-col max-h-[90vh]">
            <div class="p-4 border-b flex justify-between items-center bg-yellow-50 rounded-t-xl"><h3 class="font-bold text-lg text-yellow-800"><i class="fas fa-users-cog"></i> 營主管理後台</h3><button onclick="closeAll()"><i class="fas fa-times"></i></button></div>
            <div class="p-6 overflow-y-auto">
                <div class="flex justify-between items-center mb-4"><h4 class="font-bold text-lg border-l-4 border-yellow-500 pl-2">會員列表</h4><button onclick="loadMembers()" class="text-sm bg-gray-200 px-3 py-1 rounded hover:bg-gray-300 transition"><i class="fas fa-sync"></i> 重新整理</button></div>
                <div class="overflow-x-auto border rounded-lg shadow-inner"><table class="min-w-full text-sm text-left text-gray-600"><thead class="text-xs text-gray-700 uppercase bg-gray-100"><tr><th class="px-4 py-3">會員代號</th><th class="px-4 py-3">姓名</th><th class="px-4 py-3">電話</th><th class="px-4 py-3">Line ID</th><th class="px-4 py-3 text-center">報名次數</th><th class="px-4 py-3 text-center">退款次數</th><th class="px-4 py-3">最後互動</th></tr></thead><tbody id="memberTableBody" class="divide-y divide-gray-200 bg-white"><tr><td colspan="7" class="text-center py-4">請點擊重新整理...</td></tr></tbody></table></div>
            </div>
            <div class="p-4 border-t text-right bg-gray-50 rounded-b-xl"><a id="adminSheetLink" href="#" target="_blank" class="text-blue-600 underline text-sm mr-4">開啟 Google 試算表</a><button onclick="closeAll()" class="bg-stone-500 text-white px-4 py-2 rounded">關閉</button></div>
        </div>
    </div>

    <script>
        // ============================================
        // 設定區
        // ============================================
        const scriptURL = 'https://script.google.com/macros/s/AKfycbw3oeSoCRCl2098Wqjl1CyTQ4fE3kz2Zw2aYdXMFmYei0B0q8VWu7V_MCmPbjkMDmXe/exec'; 
        const adminSheetURL = 'https://docs.google.com/spreadsheets/d/1frnxcFu6ZvYjUaSRpbq84ROjWYIY4mrHLDyjR1InyXg/edit?gid=658452245#gid=658452245';
        // ============================================

        // 營位資料 (已更新三人頂級露營車圖片路徑)
        const zones = [
            { name: '棚架 A 區', count: 9, icon: 'fa-warehouse', desc: '共9帳', img: 'https://i.ibb.co/KjBcKGvt/A-DDcar.jpg' },
            { name: '棚架 B 區', count: 4, icon: 'fa-warehouse', desc: '共4帳', img: 'https://i.ibb.co/bMQ51htS/B.jpg' },
            { name: '棚架 C 區', count: 3, icon: 'fa-warehouse', desc: '共3帳', img: 'https://i.ibb.co/c70KNkJ/C1.jpg' },
            { name: '棧板 A 區', count: 3, icon: 'fa-layer-group', desc: '共3帳', img: 'https://i.ibb.co/XrMggq46/1.jpg' },
            { name: '棧板 B 區', count: 2, icon: 'fa-layer-group', desc: '共2帳', img: 'https://i.ibb.co/JRmcf3bw/B.jpg' },
            { name: '三人頂級露營車', count: 2, icon: 'fa-caravan', desc: '絕美體驗，冷暖氣俱全', img: 'https://i.ibb.co/HDGLKgKV/image-1-png.jpg' },
            { name: '小木屋 (大)', count: 1, icon: 'fa-home', desc: '家庭首選', img: 'https://i.ibb.co/4n2CPt5X/image.jpg' },
            { name: '小木屋 (小)', count: 1, icon: 'fa-home', desc: '溫馨三人', img: 'https://i.ibb.co/CpNgsKHw/image.jpg' },
            { name: '草地區', count: 5, icon: 'fa-tree', desc: '親近自然', img: 'https://i.ibb.co/S73TLHJR/2.jpg' },
            { name: '碎石地區', count: 2, icon: 'fa-shapes', desc: '排水佳', img: 'https://i.ibb.co/S73TLHJR/2.jpg' },
            { name: '包棟民宿 (16人)', count: 1, icon: 'fa-building', desc: '專屬私密空間', img: 'https://i.ibb.co/6RyZYPVy/7-KW.jpg' },
            { name: '泰式免搭', count: 1, icon: 'fa-campground', desc: '懶人新體驗', img: 'https://i.ibb.co/60bXNB57/image.jpg' }
        ];

        const container = document.getElementById('zoneContainer');
        const input = document.getElementById('selectedZoneInput');
        const adminLink = document.getElementById('adminSheetLink');
        if(adminLink) adminLink.href = adminSheetURL;

        // 渲染圖片卡片
        zones.forEach(zone => {
            const div = document.createElement('div');
            div.className = 'zone-card bg-white border border-gray-100 rounded-lg shadow-sm cursor-pointer overflow-hidden flex flex-col group';
            div.innerHTML = `
                <div class="relative h-40 overflow-hidden">
                    <img src="${zone.img}" alt="${zone.name}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
                    <div class="absolute top-2 right-2 bg-white/90 backdrop-blur-sm px-2 py-1 rounded-md text-xs font-bold shadow-sm text-green-700">
                        <i class="fas ${zone.icon} mr-1"></i> ${zone.desc}
                    </div>
                </div>
                <div class="p-3">
                    <h4 class="font-bold text-gray-800 text-lg">${zone.name}</h4>
                </div>
            `;
            div.onclick = () => {
                document.querySelectorAll('.zone-card').forEach(c => c.classList.remove('selected', 'ring-2', 'ring-green-500'));
                div.classList.add('selected', 'ring-2', 'ring-green-500');
                input.value = zone.name;
            };
            container.appendChild(div);
        });

        // 日期自動跳轉與天數計算
        function updateDuration() {
            const checkin = new Date(document.getElementById('checkinDate').value);
            const checkout = new Date(document.getElementById('checkoutDate').value);
            
            if(checkin && checkout && checkout > checkin) {
                const diffTime = Math.abs(checkout - checkin);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
                document.getElementById('durationDisplay').value = `${diffDays+1}天${diffDays}夜`;
            } else {
                document.getElementById('durationDisplay').value = "請選擇日期";
            }
        }

        document.getElementById('checkinDate').addEventListener('change', function() {
            const checkin = new Date(this.value);
            if(checkin) {
                const checkout = new Date(checkin);
                checkout.setDate(checkout.getDate() + 1);
                const nextDay = checkout.toISOString().split('T')[0];
                const outEl = document.getElementById('checkoutDate');
                outEl.value = nextDay;
                outEl.min = nextDay;
                updateDuration();
            }
        });

        document.getElementById('checkoutDate').addEventListener('change', updateDuration);


        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('sidebar-open');
            document.getElementById('overlay').classList.toggle('hidden');
        }

        function showModal(id) {
            document.getElementById('sidebar').classList.remove('sidebar-open');
            document.getElementById('overlay').classList.remove('hidden');
            document.querySelectorAll('.modal').forEach(m => m.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        function closeAll() {
            document.getElementById('sidebar').classList.remove('sidebar-open');
            document.querySelectorAll('.modal').forEach(m => m.classList.add('hidden'));
            document.getElementById('overlay').classList.add('hidden');
        }

        function openAdminPanel() {
            const password = prompt("請輸入營主密碼：");
            if (password === "Hank0219") {
                showModal('modal-admin');
                loadMembers();
            } else if (password !== null) {
                alert("密碼錯誤！");
            }
        }

        function loadMembers() {
            const tbody = document.getElementById('memberTableBody');
            tbody.innerHTML = '<tr><td colspan="7" class="text-center py-4 text-gray-500"><i class="fas fa-spinner fa-spin mr-2"></i>資料載入中...</td></tr>';
            fetch(scriptURL + '?action=get_members')
                .then(res => res.json())
                .then(json => {
                    tbody.innerHTML = '';
                    if (json.data && json.data.length > 0) {
                        json.data.forEach(row => {
                            const date = row[6] ? new Date(row[6]).toLocaleDateString() : '-';
                            const tr = `<tr class="bg-white border-b hover:bg-gray-50"><td class="px-4 py-3 font-mono">${row[0]}</td><td class="px-4 py-3">${row[1]}</td><td class="px-4 py-3 text-gray-500">${row[2]}</td><td class="px-4 py-3 text-blue-600">${row[3] || '-'}</td><td class="px-4 py-3 text-center"><span class="bg-green-100 text-green-800 text-xs font-bold px-2 py-1 rounded-full">${row[4]}</span></td><td class="px-4 py-3 text-center text-red-500 font-bold">${row[5] > 0 ? row[5] : '-'}</td><td class="px-4 py-3 text-xs text-gray-400">${date}</td></tr>`;
                            tbody.innerHTML += tr;
                        });
                    } else {
                        tbody.innerHTML = '<tr><td colspan="7" class="text-center py-8 text-gray-400">目前沒有會員資料</td></tr>';
                    }
                })
                .catch(err => { console.error(err); tbody.innerHTML = '<tr><td colspan="7" class="text-center py-4 text-red-500">載入失敗</td></tr>'; });
        }

        function handleFormSubmit(formId, btnId) {
            const form = document.getElementById(formId);
            const btn = document.getElementById(btnId);
            form.addEventListener('submit', e => {
                e.preventDefault();
                if(formId === 'bookingForm' && !input.value) { alert('請選擇一個營位區域！'); return; }
                
                // 處理手動填寫的 Line ID
                if(formId === 'bookingForm') {
                    const manualLine = document.querySelector('input[name="LineID_Manual"]').value;
                    const hiddenLine = document.querySelector('input[name="LineID"]');
                    if(manualLine) hiddenLine.value = manualLine;
                }

                btn.disabled = true;
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> 處理中...';
                document.body.classList.add('loading');
                
                fetch(scriptURL, { method: 'POST', body: new FormData(form)})
                    .then(res => res.json())
                    .then(data => {
                        alert(data.msg);
                        form.reset();
                        if(formId === 'bookingForm') { document.querySelectorAll('.zone-card').forEach(c => c.classList.remove('selected', 'ring-2', 'ring-green-500')); input.value = ''; }
                        if(formId === 'paymentForm') closeAll();
                    })
                    .catch(error => { console.error('Error!', error); alert('發生錯誤，請稍後再試。'); })
                    .finally(() => { btn.disabled = false; btn.innerHTML = originalText; document.body.classList.remove('loading'); });
            });
        }

        handleFormSubmit('bookingForm', 'submitBtn');
        handleFormSubmit('paymentForm', 'payBtn');
    </script>
</body>
</html>